# Docker Compose configuration for Android build

services:
  android-builder:
    build: .
    volumes:
      # Mount the source code (read-write for npm install)
      - ./app:/app
      # Output directory for build artifacts
      - ./build-output:/build-output
      # Cache volume for Gradle dependencies
      - gradle-cache:/root/.gradle
      # Cache volume for npm dependencies
      - npm-cache:/root/.npm
    environment:
      - GRADLE_OPTS=-Dorg.gradle.daemon=false
    command: >
      sh -c "
        echo 'ðŸš€ Starting NexSplit Android Build with Docker...' &&
        cd /app &&
        /app/build.sh &&
        echo 'ðŸ“¦ Copying build artifacts to output volume...' &&
        mkdir -p /build-output &&
        cp -r android/app/build/outputs/apk/debug/* /build-output/ 2>/dev/null || true &&
        cp -r android/app/build/outputs/apk/release/* /build-output/ 2>/dev/null || true &&
        echo 'âœ… Build artifacts copied to /build-output/' &&
        ls -la /build-output/ &&
        echo 'ðŸŽ‰ Build process completed successfully!'
      "

volumes:
  gradle-cache:
    driver: local
  npm-cache:
    driver: local
